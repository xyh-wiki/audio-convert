:3000 {
  # Enable gzip compression
  encode gzip

  # Root directory for static files
  root * /app/dist

  # CRITICAL: Set headers for FFmpeg SharedArrayBuffer support
  header Cross-Origin-Opener-Policy "same-origin"
  header Cross-Origin-Embedder-Policy "require-corp"

  # MIME types for FFmpeg assets
  @wasm path *.wasm
  header @wasm Content-Type "application/wasm"

  @worker path *.worker.js
  header @worker Content-Type "application/javascript"

  # Caching strategies
  @versioned path /assets/*
  header @versioned Cache-Control "public, max-age=31536000, immutable"

  @html path *.html
  header @html Cache-Control "no-cache, no-store, must-revalidate"

  @ffmpeg path /ffmpeg/*
  header @ffmpeg Cache-Control "public, max-age=31536000, immutable"

  # Serve static files
  file_server

  # SPA fallback
  try_files {path} /index.html
}
